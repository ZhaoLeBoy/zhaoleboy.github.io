I"›<p>```java
 //NioEventLoop.java
//é‡æ–°æ„é€ ä¸ªselector
private void rebuildSelector0() {
  final Selector oldSelector = selector;
  final SelectorTuple newSelectorTuple;
  â€¦
  try {
    newSelectorTuple = openSelector();
  }
  â€¦</p>

<p>//è·å–è¿™ä¸ªselectorä¸Šæ‰€æœ‰æ³¨å†Œçš„channelkey
  for (SelectionKey key : oldSelector.keys()) {
    Object a = key.attachment();
    try {
        if (!key.isValid() || key.channel().keyFor(newSelectorTuple.unwrappedSelector) != null) {
            continue;
        }
        //è¿™ä¸ªselectä¸Šæ‰€æœ‰æ„Ÿå…´è¶£äº‹ä»¶
        int interestOps = key.interestOps();
        key.cancel();</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>    SelectionKey newKey = key.channel().register(newSelectorTuple.unwrappedSelector, interestOps, a);
    if (a instanceof AbstractNioChannel) {
        ((AbstractNioChannel) a).selectionKey = newKey;
    }
    nChannels++;
} catch (Exception e) {
    ...
}   }
</pre></td></tr></tbody></table></code></pre></div></div>
:ET